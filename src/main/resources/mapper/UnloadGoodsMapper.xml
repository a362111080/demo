<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zero.egg.dao.UnloadGoodsMapper">
    <insert id="AddUnloadDetl" parameterType="UnloadGoods">
    insert into bd_unload_goods(id,shop_id,company_id,supplier_id,specification_id,program_id,task_id,goods_category_id,goods_no,marker,mode,weight,warn,remark,creator,createtime,modifier,modifytime,dr)
    values(REPLACE(UUID(),'-',''),#{shopId},#{companyId},#{supplierId},#{specificationId},#{programId},#{taskId},#{goodsCategoryId},
    #{goodsNo},#{marker},#{mode},#{weight},#{warn},#{remark},#{creator},#{createtime},#{modifier},#{modifytime},0)
    </insert>
    <select id="CheckWeight"  resultType="com.zero.egg.responseDTO.UnLoadResponseDto">
        SELECT IFNULL(k.numerical,0) as numerical ,k.marker,k.id as specificationId,k.mode  FROM bd_specification  k
        where k.program_id=#{programId}  and k.weight_min <![CDATA[ <= ]]> #{weight}  and k.weight_max <![CDATA[ > ]]> #{weight}  and k.dr=0
    </select>
    <select id="QueryUnloadGood"  resultType="com.zero.egg.responseDTO.UnLoadGoodsQueryResponseDto">
        select b.name,a.supplier_id,a.task_id,b.id,sum(1) as sumVal,pro.name as programname,a.program_id as programId,a.goods_category_id as goodsCategoryId from  bd_unload_goods  a
        left join  bd_category  b  on  a.goods_category_id=b.id
        left join bd_specification_program pro on pro.id=a.program_id
        where  a.task_id=#{taskId} and  a.dr=0
        GROUP BY  a.task_id,b.id,a.supplier_id,pro.name,a.program_id,a.goods_category_id
    </select>
    <select id="QueryUnloadGoodForDay"  resultType="com.zero.egg.responseDTO.UnLoadGoodsQueryResponseDto">
        select b.name,a.shop_id,b.id,sum(1) as sumVal from  bd_unload_goods  a
        left join  bd_category  b  on  a.goods_category_id=b.id
        where  a.shop_id=#{shopId}   and  left(a.createtime,10)=#{unloadTime} and  a.dr=0
        GROUP BY  a.shop_id,b.id
    </select>

    <select id="GetTaskUnloadCount"  resultType="int">
        select COUNT(1) as sumVal from  bd_unload_goods  a
        where  a.task_id=#{taskId} and  a.dr=0
    </select>

    <select id="GetTaskStatusBySupplier" parameterType="java.lang.String" resultType="java.lang.String">
        select  CONCAT(a.status,",",a.id,",",b.program_id) as status from  bd_task  a
        left  join  bd_task_program b on a.id=b.task_id  and b.active=TRUE
        where  a.cussup_id=#{supplierId} and  a.dr=0  and a.status in ('3','0')
    </select>

    <select id="GetTaskProgram"  resultType="com.zero.egg.responseDTO.UnLoadGoodsQueryResponseDto">
        select a.program_id as programId,b.category_id as goodsCategoryId,a.task_id,e.status from bd_task_program  a
        left join bd_specification_program  b on a.program_id=b.id
        left join bd_task  e on e.id=a.task_id
        where a.active=1  and a.task_id= #{taskId,jdbcType=VARCHAR}
    </select>


    <select id="GetUnloadList"  resultType="com.zero.egg.model.UnloadGoods">
        SELECT a.*,b.name as categoryName FROM bd_unload_goods a
        left join bd_category b on a.goods_category_id=b.id
        where task_id=#{taskId}
        <if test="programId != null and programId !=''">
            and a.program_id=#{programId,jdbcType=VARCHAR}
        </if>
        <if test="warn != null and warn !=''">
            and a.warn=#{warn,jdbcType=BOOLEAN}
        </if>
        order by a.goods_category_id

    </select>

    <select id="GetBarCodeInfo"  resultType="com.zero.egg.model.BarCode">
       select * from bd_barcode  k where k.id=#{qrCode,jdbcType=VARCHAR}
    </select>

</mapper>
